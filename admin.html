<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin - BioAthletic</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
:root {
    --primary: #FF3B3B;
    --bg: #0A0A0A;
    --card-bg: #161616;
    --text: #FFF;
    --hover: rgba(255,59,59,0.2);
    --transition: all 0.3s ease;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Montserrat', sans-serif; }
body { background: var(--bg); color: var(--text); min-height: 100vh; }

header {
    background: var(--card-bg);
    text-align: center;
    padding: 20px;
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--primary);
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 15px;
}

/* LOGIN */
.login-box {
    background: var(--card-bg);
    padding: 30px 20px;
    border-radius: 15px;
    box-shadow: 0 10px 30px var(--hover);
    max-width: 400px;
    margin: 0 auto 40px auto;
    text-align: center;
}
.login-box h2 { margin-bottom: 20px; color: var(--primary); font-weight: 900; }
.login-box input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 10px;
    border: 1px solid #222;
    background: #0f0f0f;
    color: var(--text);
    font-size: 1rem;
    transition: var(--transition);
}
.login-box input:focus { border-color: var(--primary); outline:none; box-shadow:0 0 8px var(--primary);}
.login-box button {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border:none;
    font-weight: 700;
    background: var(--primary);
    color:#fff;
    cursor:pointer;
    transition: var(--transition);
}
.login-box button:hover { filter: brightness(1.2); }
#loginStatus { margin-top: 10px; font-weight:600; }

/* PAINEL */
.panel { display:none; background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px var(--hover); }
.panel h2 { text-align:center; margin-bottom:20px; color: var(--primary); }

/* FILTROS */
.filter-group {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:15px;
}
.filter-group input, .filter-group select, .filter-group button {
    flex:1;
    padding:10px;
    border-radius:8px;
    border:1px solid #222;
    background:#0f0f0f;
    color:#fff;
    font-size:0.95rem;
}
.filter-group button {
    flex:0 0 120px;
    background: var(--primary);
    font-weight:700;
    border:none;
    cursor:pointer;
}
.filter-group button:hover { filter: brightness(1.2); }

#btnApagarSelecionados {
    padding:10px;
    border-radius:10px;
    background:#ff5555;
    font-weight:700;
    border:none;
    cursor:pointer;
    margin-bottom:10px;
}
#btnApagarSelecionados:hover { filter: brightness(1.2); }

/* TABELA RESPONSIVA */
.table-wrapper { overflow-x:auto; }
table { width:100%; border-collapse:collapse; min-width:600px; }
th, td { padding:10px; text-align:left; border-bottom:1px solid #222; font-size:0.95rem; }
th { background:#1a1a1a; font-weight:700; }
tr:hover { background:#222; }
.checkbox-cell { text-align:center; }
.btnApagar {
    padding:5px 10px;
    border:none;
    border-radius:8px;
    background:#ff5555;
    color:#fff;
    cursor:pointer;
    font-weight:600;
    transition:0.3s;
}
.btnApagar:hover { filter: brightness(1.2); }

/* RESPONSIVO */
@media(max-width:768px){
    .filter-group { flex-direction: column; }
    .filter-group button { width: 100%; }
    .login-box { padding:20px 15px; }
}
</style>
</head>
<body>

<header>BioAthletic - Painel Administrativo</header>

<div class="container">

    <!-- LOGIN -->
    <div class="login-box" id="loginBox">
        <h2>Login do Administrador</h2>
        <input type="text" id="adminNome" placeholder="Nome Completo">
        <input type="text" id="adminCpf" placeholder="CPF">
        <input type="password" id="adminSenha" placeholder="Senha">
        <button id="btnLogin">Entrar</button>
        <div id="loginStatus"></div>
    </div>

    <!-- PAINEL -->
    <div class="panel" id="adminPanel">
        <h2>Gerenciar Alunos</h2>

        <div class="filter-group">
            <input type="number" id="filterValor" placeholder="Filtrar por Mensalidade (R$)">
            <input type="number" id="filterMeses" placeholder="Filtrar por meses na academia">
            <button id="btnFiltrar">Filtrar</button>
            <button id="btnLimparFiltro">Limpar Filtro</button>
        </div>

        <button id="btnApagarSelecionados">Apagar Selecionados</button>

        <div class="table-wrapper">
            <table id="alunosTable">
                <thead>
                    <tr>
                        <th class="checkbox-cell"><input type="checkbox" id="selectAll"></th>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Telefone</th>
                        <th>Mensalidade (R$)</th>
                        <th>Meses na Academia</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

</div>

<script>
const API_URL = 'https://apiphp-production-bce2.up.railway.app';

// LOGIN
document.getElementById('btnLogin').addEventListener('click', async () => {
    const nome = document.getElementById('adminNome').value.trim();
    const cpf = document.getElementById('adminCpf').value.trim();
    const senha = document.getElementById('adminSenha').value;

    if(!nome || !cpf || !senha) return alert('Preencha todos os campos');

    const fd = new FormData();
    fd.append('nome', nome);
    fd.append('cpf', cpf);
    fd.append('senha', senha);

    try {
        const res = await fetch(`${API_URL}?action=login`, { method:'POST', body:fd });
        const data = await res.json();
        if(data.status==='success') {
            document.getElementById('loginBox').style.display='none';
            document.getElementById('adminPanel').style.display='block';
            carregarAlunos();
        } else {
            document.getElementById('loginStatus').innerText='Login inválido';
            document.getElementById('loginStatus').style.color='#ff5555';
        }
    } catch(err){
        console.error(err);
        alert('Erro ao conectar com a API');
    }
});

// CARREGAR ALUNOS
let alunosData = [];
async function carregarAlunos(){
    try{
        const res = await fetch(`${API_URL}?action=listar_alunos`);
        const data = await res.json();
        alunosData = data.data || [];
        renderTable(alunosData);
    } catch(err){
        console.error(err);
        alert('Erro ao carregar alunos');
    }
}

// RENDERIZAR TABELA
function renderTable(data){
    const tbody = document.querySelector('#alunosTable tbody');
    tbody.innerHTML='';
    data.forEach(aluno=>{
        const tr = document.createElement('tr');
        tr.innerHTML=`
            <td class="checkbox-cell"><input type="checkbox" class="selectAluno" data-cpf="${aluno.cpf}"></td>
            <td>${aluno.nome}</td>
            <td>${aluno.cpf}</td>
            <td>${aluno.telefone}</td>
            <td>${aluno.mensalidade.toFixed(2)}</td>
            <td>${aluno.meses_na_academia}</td>
            <td><button class="btnApagar" data-cpf="${aluno.cpf}">Apagar</button></td>
        `;
        tbody.appendChild(tr);
    });
}

// APAGAR INDIVIDUAL
document.addEventListener('click', async (e)=>{
    if(e.target.classList.contains('btnApagar')){
        if(!confirm('Deseja realmente apagar este aluno?')) return;
        const cpf = e.target.dataset.cpf;
        await apagarAlunos([cpf]);
        carregarAlunos();
    }
});

// SELECIONAR TODOS
document.getElementById('selectAll').addEventListener('change', (e)=>{
    document.querySelectorAll('.selectAluno').forEach(chk=>{
        chk.checked = e.target.checked;
    });
});

// APAGAR SELECIONADOS
document.getElementById('btnApagarSelecionados').addEventListener('click', async ()=>{
    const selecionados = Array.from(document.querySelectorAll('.selectAluno:checked')).map(chk=>chk.dataset.cpf);
    if(selecionados.length===0) return alert('Nenhum aluno selecionado');
    if(!confirm(`Deseja realmente apagar ${selecionados.length} aluno(s)?`)) return;
    await apagarAlunos(selecionados);
    carregarAlunos();
});

// FUNÇÃO APAGAR
async function apagarAlunos(cpfs){
    for(const cpf of cpfs){
        const fd = new FormData();
        fd.append('cpf', cpf);
        try{
            await fetch(`${API_URL}?action=apagar_aluno`, { method:'POST', body:fd });
        } catch(err){ console.error(err); }
    }
}

// FILTROS
document.getElementById('btnFiltrar').addEventListener('click', ()=>{
    const valor = parseFloat(document.getElementById('filterValor').value);
    const meses = parseInt(document.getElementById('filterMeses').value);
    let filtered = alunosData;

    if(!isNaN(valor)) filtered = filtered.filter(a=>a.mensalidade===valor);
    if(!isNaN(meses)) filtered = filtered.filter(a=>a.meses_na_academia===meses);

    renderTable(filtered);
});

// LIMPAR FILTRO
document.getElementById('btnLimparFiltro').addEventListener('click', ()=>{
    document.getElementById('filterValor').value='';
    document.getElementById('filterMeses').value='';
    renderTable(alunosData);
});
</script>

</body>
</html>
